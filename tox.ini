[tox]
requires = tox>=4
env_list =
    py{37,38,39,310,311,312,313,313t}
    pypy{37,38,39,310,311}
    flake8, isort, mypy, pyright

[gh-actions]
python =
    3.7: py37
    3.8: py38
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312
    3.13: py313, flake8, isort, mypy, pyright
    3.13t: py313t
    pypy-3.7: pypy37
    pypy-3.8: pypy38
    pypy-3.9: pypy39
    pypy-3.10: pypy310
    pypy-3.11: pypy311

[testenv]
description = Run unit tests
package = wheel
allowlist_externals = poetry
commands_pre =
    poetry export --only=test --output={env_tmp_dir}/requirements.txt
    pip install -qr {env_tmp_dir}/requirements.txt
commands =
    pytest --color=yes

[testenv:flake8]
description = flake8 lint
basepython = py313
commands_pre =
    poetry export --only=analyze --output={env_tmp_dir}/requirements.txt
    pip install -qr {env_tmp_dir}/requirements.txt
commands =
    flake8

[testenv:isort]
description = isort check
basepython = py313
commands_pre =
    poetry export --only=analyze --output={env_tmp_dir}/requirements.txt
    pip install -qr {env_tmp_dir}/requirements.txt
commands =
    isort --check .

[testenv:mypy]
description = mypy typecheck
basepython = py313
commands_pre =
    poetry export --only=test,analyze --output={env_tmp_dir}/requirements.txt
    pip install -qr {env_tmp_dir}/requirements.txt
commands =
    mypy .

[testenv:pyright]
description = pyright typecheck
basepython = py313
commands_pre =
    poetry export --only=test,analyze --output={env_tmp_dir}/requirements.txt
    pip install -qr {env_tmp_dir}/requirements.txt
commands =
    pyright
